# タスク完了時のチェックリスト

## コード作成・修正後の必須チェック

### 1. 静的解析（PHPStan）
```bash
composer phpstan
```
- **レベル**: 最大レベル + strict rules
- **対象**: src/とtests/
- **エラーゼロであること**

### 2. コードスタイルチェック
```bash
composer cs-check
```
- **基準**: PSR-12完全準拠
- **違反がないこと**

必要に応じて自動修正：
```bash
composer cs-fix
```

### 3. テスト実行
```bash
composer test
```
- **全テストがパスすること**
- 新機能追加時は対応するテストを追加

### 4. 統合チェック
```bash
composer check
```
このコマンドは以下を順次実行：
1. PHPStan
2. コードスタイルチェック
3. テスト

**全てパスすることを確認**

## セキュリティチェック

### セッションID取り扱い
- [ ] ログ出力時にセッションIDをマスキングしているか
- [ ] 末尾4文字のみ表示する実装になっているか

### 入力検証
- [ ] 設定クラスで入力値の妥当性検証を実施しているか
- [ ] 不正な値に対して適切な例外を投げているか

## Git操作

### コミット前
```bash
# 必ず実行
composer phpstan
composer cs-check
```

### コミットメッセージ
- 日本語で記述
- 1行で変更の理由（WHY）を説明
- 複数の独立した修正は別々のコミットに分割

### PRレビュー対応時
1. 各指摘事項ごとに個別のコミットを作成
2. コミットメッセージでレビュー指摘の理由を説明
3. 全修正完了後、PRにまとめコメントを投稿
4. PHPStanとPHP CS Fixerが通過していることを確認

## CI/CD確認

GitHub Actionsで以下が自動実行されることを確認：
- 静的解析（PHPStan）
- コードスタイルチェック
- テスト実行
- Docker環境でのテスト

**全てのチェックが通過すること**

## 後方互換性

このプロジェクトはライブラリであるため：
- 破壊的変更を避ける
- 後方互換性を重視
- `composer.lock`は非コミット（CIが毎回依存関係を解決）

## ドキュメント更新

重要な変更の場合は以下を更新：
- [ ] README.md
- [ ] doc/配下の関連ドキュメント
- [ ] .claude/CLAUDE.md（必要に応じて）
- [ ] CHANGELOG.md
